# 다양한 필터링을 활용한 영화 추천 시스템

## 목차
0. 준비 단계
1. Simple 영화 추천 시스템
2. Pearson Corrleation 기반 추천 시스템
3. 콘텐츠 기반 추천 시스템
 - 3-1. 영화 설명 기반
 - 3-2. Metadata(제작진, 출연진 등) 기반
 - 3-3. 인기도, 평점 추가
4. 협업 필터링 추천 시스템
5. 하이브리드 추천 시스템
6. 결론


## 0. 준비 단계

### 프로젝트를 선정한 계기

많은 사람들이 사용하는 넷플릭스는 단순한 인기작뿐만이 아닌 사용자의 성향에 따른 다양한 영화들을 관람할 수 있게 추천 알고리즘이 구성되어 있다.

항상 이런 추천 시스템이 어떤식으로 구현되는지 궁금했었는데, 이번 프로젝트를 계기로 궁금증을 해소할 겸 스스로 한 번 영화 추천 시스템을 만들어 보자는 생각에 이 프로젝트를 선정하게 되었다.

#### 데이터 셋 링크
https://drive.google.com/drive/u/1/folders/0AM7WW25cfFwdUk9PVA

### TMDB 데이터 셋에 대한 탐색적 데이터 분석(EDA)

TMDB(https://www.themoviedb.org/) 는 전세계 다양한 사용자들에게 영화 정보와 리뷰를 받아 만들어진 영화 데이터베이스로, 영화 관련 데이터 분석을 할 때 가장 많이 쓰이는 데이터 셋 중 하나다. 

본인 역시 추천 시스템을 구상하기에 앞서 많은 시간을 할애하여 데이터를 분석하는 과정을 거쳤다. 예상보다 분석을 많이 활용하지는 못했지만, 이 과정을 통해 데이터 셋을 보다 잘 이해할 수 있었다. 

### 들어가기에 앞서

영화 입력값은 개인적으로 가장 좋아하는 영화인 'Star Wars'를 기준으로 하였다. 사용자는 ID로 구성되어 있으므로 임의로 지정했다. 구체적인 코드와 진행 과정은 .ipynb 파일에 있으므로, 진행 과정의 생략을 적당히 하며 보고서를 진행하겠다.

## 1. Simple 영화 추천 시스템

TMDB 데이터 셋의 EDA을 통해 데이터의 파악을 마쳤다. 그렇다면 분석이 완료된 데이터들을 활용해 사용자에게 알맞은 영화를 추천해 줄 수 있는 시스템들을 구상해보자.

이번 연구에서 구상한 추천 시스템은 총 5개이다. 단순히 인기가 많은 영화를 추천하는 간단한 시스템부터, 개별 영화와 사용자의 성향을 파악하여 추천해주는 보다 복잡한 시스템까지 구현해보았다.

시스템들을 구성 및 구현하는 일련의 과정을 나열함으로써 시스템마다 발전시킨 부분과 그 부분들로 인해 나타난 결과(추천 목록)의 차이를 바로 볼 수 있게 하였다.

첫번째로 TMDB의 Rating 데이터 셋을 통해 가중치 공식을 사용하여 상위 영화 차트를 생성할 것이다. 가중치 공식은 수학적으로 다음과 같이 표현된다.

- Weighted Rating(WR) = (𝑣/(𝑣+𝑚)X𝑅)+(𝑚/(𝑣+𝑚)X𝐶)  
- v는 영화에 대한 vote 수.  
- m은 차트에 사용하기 위해 필요한 최소 vote 수.  
- R는 영화의 평균 rating.  
- C는 전체 보고서에 걸친 평균 vote 수.  

전체 상위 영화와 장르별 상위 영화 추천 결과를 살펴보자.

- 상위 영화 차트
![1-1](https://user-images.githubusercontent.com/73309550/101662177-879d5680-3a8c-11eb-8f60-af1cc60471a6.PNG)


- 장르별 상위 영화 차트(Romance)
![1-2](https://user-images.githubusercontent.com/73309550/101662211-91bf5500-3a8c-11eb-9c56-0f6cda75ca86.PNG)


첫번째 시스템은 Vote의 개수와 Rating만을 사용했기 때문에 "추천" 시스템이라고 하기엔 부족한 면이 많다. 그렇다면 본격적으로 영화 "추천" 시스템을 구현해보자.

## 2. Pearson Correlation을 활용한 추천 시스템

이번 연구에서 활용하고 있는 데이터 셋에는 약 2600만개의 사용자들이 평가한 영화들의 평점들이 존재한다. 이러한 평점들을 집중적으로 활용한 추천시스템을 구현해 보고자 한다.

여기서는 피어슨 상관 계수를 사용할 예정이다. 피어슨 상관계수를 적용할 수 있는 이유는 아래와 같다.

만약 두 사람이 보는 영화들이 비슷하다면 영화 취향 역시 비슷할 것이다. 그렇다면 그 두 사람 중 한 사람이 평가한 특정 영화에 대해 좋은 평가를 내린다면, 다른 사람 역시 좋은 평가를 내릴 수 있다고 유추해볼 수 있다. 이러한 방법을 통해 시스템을 구상해 보았다.

- 실행 결과
![2](https://user-images.githubusercontent.com/73309550/101662232-984dcc80-3a8c-11eb-826a-b99a8260ec71.PNG)

## 3. 콘텐츠 기반 추천 시스템

앞서 만든 Simple 영화 추천 시스템은 몇 가지 문제점이 있다. 우선, 사용자의 개인적 취향에 상관없이 모든 사람에게 동일한 영화들을 추천한다는 것이다. 만약 로맨틱 영화를 좋아하고 액션을 싫어하는 사람이 이 추천 시스템의 상위 15위 차트를 본다면, 그는 아마 대부분의 영화를 좋아하지 않을 것이다. 한 걸음 더 나아가 장르별로 차트를 살펴본다 하더라도, 영화의 많은 요소들을 포함하지 않기 때문에, 여전히 만족할 만한 추천을 받지 못할 가능성이 크다.

따라서 보다 추천을 좀 더 개인화(personalize)하기 위해 특정 요소들을 바탕으로 영화 간 유사성을 계산하고 사용자가 좋아했던 특정 영화와 가장 유사한 영화를 제안하는 추천 시스템을 만들 생각이다. 영화 메타데이터(metadata)를 사용할 것이기 때문에, 이를 콘텐츠 기반 추천 시스템이라고 지칭 하겠다.

다음을 기반으로 두 개의 콘텐츠 기반 추천 시스템을 구축했다.

- 영화 Overviews 및 tagline(슬로건 같은 문구)
- 영화 출연진, 제작진, 키워드 및 장르

### 3-1. 영화 설명 기반 추천 시스템

영화 Overviews 및 tagline을 사용하여 시스템을 구축하였다. 여기서는 TF-IDF Vectorizer를 사용했고, 이를 통해 Dot Product를 계산하면 Cosine 유사도 점수가 나온다. 따라서 여기서는 훨씬 속도가 빠른 sklearn의 linear_kernel을 사용할 것이다.

- 실행 결과
![3-1](https://user-images.githubusercontent.com/73309550/101667219-650e3c00-3a92-11eb-9aba-bb74ca828ca7.PNG)

스타워즈를 확인해보면, 현재의 시스템이 그것을 스타워즈 시리즈 영화라고 식별하고 그 후에 다른 스타워즈 영화들을 추천작으로 추천하는 것을 확인할 수 있다. 불행히도 이 시스템이 현재 할 수 있는 일은 이정도 뿐이다. 이것은 영화의 평점과 인기를 좌우하는 출연진, 제작진, 감독, 장르와 같은 매우 중요한 특징들을 고려하지 않기 때문이다.

따라서 Overview와 Tagline보다 훨씬 더 유용한 메타데이터를 사용(or 추가)해야 한다.

### 3-2. Metadata 기반 추천 시스템

다음의 방법들을 통해 조금 더 나아가보자.

- 제작진(Crew): 다른 제작진들은 영화의 느낌에 별로 기여하지 않기 때문에, 제작진 중에서 감독만을 추출한다.
- 출연자(Cast): 출연자는 제작진보다 좀 더 까다롭다. 덜 알려진 배우들과 단역 배우들은 실제로 영화에 대한 사람들의 의견에 영향을 미치지 않는다. 그러므로 우리는 주요 인물과 각각의 배우만을 선정해야 한다. 임의로 크레딧 리스트에 등장하는 상위 3명의 배우를 선정할 것이다.
- 키워드 : 키워드를 사용하기 전에 소량의 pre-processing을 할 것이다. 첫 번째 단계로 데이터 셋에 나타나는 모든 키워드의 frequency를 계산한다. 여기서 한 번만 발생하는 키워드는 사용하지 않을 것이고, Dogs와 Dog과 같은 단어들이 똑같이 여겨지도록 모든 단어를 stem으로 변환할 것이다.

- 실행 결과
![3-2](https://user-images.githubusercontent.com/73309550/101667853-304eb480-3a93-11eb-8a86-aef868262e67.PNG)

이번 추천은 감독의 다른 영화들을 (감독에게 주어진 높은 가중치 때문에) 인식하여 최고의 추천작으로 올린 것으로 보인다.

### 3-3. 인기도와 평점 추가

구상한 콘텐츠 기반 추천 시스템을 들여다보면, 인기도와 평점에 상관없이 영화를 추천하도록 설계되었다.

따라서 좀 더 나아가 이번 섹션에서는 비판적이고 나쁜 영화들을 제거하는 동시에, 인기 있고 반응이 좋았던 영화를 돌려줄 수 있는 메커니즘을 추가하겠다.

유사도 점수를 바탕으로 나온 상위 25개 영화에 vote count의 백분위를 60%로 계산하겠다. 그런 다음 이것을 𝑚 의 값으로 삼아 단순 추천 시스템 섹션에서와 같이 가중치 공식을 이용하여 각 영화의 Weighted rating을 산출해 볼 것이다.

- 실행 결과
![3-3](https://user-images.githubusercontent.com/73309550/101668248-a3f0c180-3a93-11eb-95a3-aa38367c25d9.PNG)

추가한 메커니즘에 따라 결과값이 바뀐 것을 확인할 수 있다.


## 4. 협업 필터링 기반 추천 시스템

지금까지 제작한 콘텐 기반 추천 시스템은 몇 가지 심각한 제약이 있다. 특정 영화에 가까운 영화만 제안할 수 있고, 사용자의 취향을 포착하고 장르를 넘나드는 추천을 제공할 수 없다는 것이다.

이전 섹션들의 추천 시스템은 어느 사람이든 특정 영화를 입력하면 똑같은 추천을 받기 때문에, 사용자의 개인적 취향을 포착하지 못한다는 점에서 personal하지 못하다.

따라서 이 섹션에서는 협업 필터링이라는 기술을 사용하여 조금 더 정교한 추천을 구상할 것이다. 사용하고 있는 데이터 셋에 방대한 양의 유저 정보들이 들어있으므로, 이러한 시스템이 구상 가능하다.

Surprise 라이브러리를 사용하여 SVD(Singular Value Decomposition)와 같은 알고리즘을 통해 RMSE(Root Mean Square Error)를 최소화하고 보다 나은 추천을 할 수 있도록 진행할 것이다.

- SVD
![4-1](https://user-images.githubusercontent.com/73309550/101668627-1c578280-3a94-11eb-85ef-79ceb4faf85f.PNG)

RMSE의 수치들이 충분히 작으므로, 이제 데이터 셋을 train하고 검토해보자.

- 실행 결과
![4](https://user-images.githubusercontent.com/73309550/101668920-84a66400-3a94-11eb-9078-4f9c919be4bd.PNG)

ID가 302인 영화의 경우 estimated prediction은 3.014로 예상된다. 하지만 이 모델은 영화가 무엇인지(또는 그 안에 무엇이 들어있는지) 상관하지 않는다는 맹점이 존재한다. 이 시스템은 순전히 할당된 영화 ID에 근거하여 작동하며, 다른 사용자들이 어떻게 영화를 평가했는지에 따라 rating을 예측하려고 노력한다.  

예상하는 바와 같이, 이 모델은 하나의 독립적인 추천 시스템으로 활용하기엔 실용성이 많이 떨어진다. 그렇다면 이를 활용해 마지막으로 하이브리드 추천 시스템을 구상해보자.

## 5. 하이브리드 추천 시스템

이 섹션에서는 콘텐츠 기반 및 협업 필터 기반 추천 시스템에서 구현한 기법을 조합한 하이브리드 추천 시스템을 구현하려 한다. 구현할 방법은 다음과 같다.

- Input: 사용자 ID 및 영화 제목
- Output: 해당 특정 사용자의 예상 rating을 기준으로 정렬된 유사한 영화들.

- 실행 결과
![5](https://user-images.githubusercontent.com/73309550/101669014-adc6f480-3a94-11eb-935f-4bafe059b066.PNG)

이와 같이, 하이브리드 추천 시스템의 경우 영화가 같지만 사용자마다 다른 영화들이 추천되는 것을 확인했다. 따라서 하이브리드 추천 시스템은 보다 개인화되고 특정 사용자에 맞게 조정된다.

## 6. 결론

하이브리드 추천 시스템으로 보다 정교한 모델을 만들어보려 했지만 이 이상은 나아가지 못했다. 모델의 특성상 사용하려는 사용자 역시 많은 영화들에 대한 평점을 입력을 해야하는데, **Cold Start**를 해결하기 위한 방법을 찾아내지 못했다.(넷플릭스나 유튜브처럼 로그가 기록되지 않는 이상, 사실상 직접 입력하는 방법 말고는 없는 것 같다.) 

이런 점으로 미루어 보았을 때, 오히려 사용자 기반 추천 시스템과 콘텐츠 기반 추천 시스템이 활용도 면에서는 훨씬 낫다고 판단된다. 이번 연구를 진행하며 정말 많은 공부를 했지만, 더 열심히 많은 공부를 해야겠다고 느낀 한 학기였다.
